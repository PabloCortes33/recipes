<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<meta name="description" content="Personal recipes collection organized by language and category">
<meta name="theme-color" content="#007BFF">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Recipes">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.svg">
<link rel="icon" type="image/svg+xml" href="icon.svg">
<title>Recipes</title>
<script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
<style>
  * { box-sizing: border-box; }
  body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
    margin: 0;
    padding: 1em; 
    background: #f5f5f5;
  }
  @media (min-width: 768px) {
    body { padding: 2em; }
  }
  .header {
    max-width: 1200px;
    margin: 0 auto 1.5em;
  }
  @media (min-width: 768px) {
    .header { margin-bottom: 2em; }
  }
  h1 { 
    color: #333; 
    margin: 0 0 0.5em 0;
    font-size: 1.8em;
  }
  @media (min-width: 768px) {
    h1 { font-size: 2.5em; }
  }
  .subtitle {
    color: #666;
    font-size: 0.85em;
  }
  @media (min-width: 768px) {
    .subtitle { font-size: 0.9em; }
  }
  .container { 
    display: grid; 
    grid-template-columns: 1fr;
    gap: 1.5em; 
    max-width: 1200px;
    margin: 0 auto;
  }
  @media (min-width: 768px) {
    .container { 
      grid-template-columns: repeat(2, 1fr);
      gap: 2em;
    }
  }
  .language-section {
    background: white;
    padding: 1em;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  @media (min-width: 768px) {
    .language-section { padding: 1.5em; }
  }
  h2 { 
    color: #333; 
    margin: 0 0 0.8em 0;
    padding-bottom: 0.5em;
    border-bottom: 2px solid #007BFF;
    font-size: 1.3em;
  }
  @media (min-width: 768px) {
    h2 { 
      font-size: 1.5em;
      margin-bottom: 1em;
    }
  }
  .folder {
    margin: 0.5em 0;
  }
  .folder-name {
    font-weight: bold;
    color: #555;
    cursor: pointer;
    padding: 0.6em 0.5em;
    background: #f9f9f9;
    border-radius: 4px;
    user-select: none;
    display: flex;
    align-items: center;
    font-size: 0.95em;
    -webkit-tap-highlight-color: rgba(0,0,0,0.1);
    min-height: 44px;
  }
  .folder-name:hover, .folder-name:active {
    background: #f0f0f0;
  }
  @media (min-width: 768px) {
    .folder-name {
      padding: 0.5em;
      font-size: 1em;
      min-height: auto;
    }
  }
  .folder-icon {
    margin-right: 0.5em;
    font-size: 0.9em;
  }
  .folder-contents {
    margin-left: 1.5em;
    padding-left: 0.5em;
    border-left: 2px solid #e0e0e0;
  }
  .folder-contents.collapsed {
    display: none;
  }
  .file {
    margin: 0.3em 0;
  }
  .file a {
    text-decoration: none;
    color: #007BFF;
    padding: 0.5em;
    display: block;
    border-radius: 4px;
    transition: background 0.2s;
    cursor: pointer;
    font-size: 0.9em;
    -webkit-tap-highlight-color: rgba(0,123,255,0.1);
    min-height: 44px;
    display: flex;
    align-items: center;
  }
  .file a:hover, .file a:active {
    background: #e3f2fd;
  }
  @media (min-width: 768px) {
    .file a {
      padding: 0.3em 0.5em;
      font-size: 1em;
      min-height: auto;
    }
  }
  .timestamp {
    text-align: center;
    color: #999;
    font-size: 0.8em;
    margin-top: 2em;
  }
  .hidden {
    display: none;
  }
  
  /* Recipe Viewer Styles */
  #recipe-viewer {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    padding: 1em;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  @media (min-width: 768px) {
    #recipe-viewer { padding: 2em; }
  }
  #recipe-viewer.hidden {
    display: none;
  }
  .back-button {
    background: #007BFF;
    color: white;
    border: none;
    padding: 0.7em 1.2em;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    margin-bottom: 1em;
    display: inline-flex;
    align-items: center;
    gap: 0.5em;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    min-height: 44px;
  }
  .back-button:hover, .back-button:active {
    background: #0056b3;
  }
  @media (min-width: 768px) {
    .back-button {
      padding: 0.5em 1em;
      min-height: auto;
    }
  }
  .refactor-button {
    background: #28a745;
    color: white;
    border: none;
    padding: 0.7em 1.2em;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    margin-bottom: 1em;
    margin-left: 0.5em;
    display: inline-flex;
    align-items: center;
    gap: 0.5em;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    min-height: 44px;
  }
  .refactor-button:hover, .refactor-button:active {
    background: #218838;
  }
  @media (min-width: 768px) {
    .refactor-button {
      padding: 0.5em 1em;
      min-height: auto;
    }
  }
  .refactor-feedback {
    display: inline-block;
    color: #28a745;
    font-size: 0.9em;
    margin-left: 0.5em;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .refactor-feedback.show {
    opacity: 1;
  }
  
  /* Serving Size Adjuster */
  .serving-adjuster {
    background: #f8f9fa;
    border: 2px solid #007BFF;
    border-radius: 8px;
    padding: 1em;
    margin: 1em 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1em;
  }
  .serving-label {
    font-weight: 600;
    color: #333;
    font-size: 1em;
  }
  .serving-controls {
    display: flex;
    align-items: center;
    gap: 0.8em;
  }
  .serving-btn {
    background: #007BFF;
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1.3em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    font-weight: bold;
  }
  .serving-btn:hover, .serving-btn:active {
    background: #0056b3;
  }
  .serving-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
  }
  .serving-value {
    font-size: 1.2em;
    font-weight: bold;
    color: #007BFF;
    min-width: 120px;
    text-align: center;
  }
  
  #recipe-content {
    line-height: 1.6;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }
  #recipe-content h1 {
    color: #333;
    border-bottom: 3px solid #007BFF;
    padding-bottom: 0.5em;
    font-size: 1.6em;
  }
  @media (min-width: 768px) {
    #recipe-content h1 { font-size: 2em; }
  }
  #recipe-content h2 {
    color: #555;
    margin-top: 1.5em;
    font-size: 1.3em;
  }
  @media (min-width: 768px) {
    #recipe-content h2 { font-size: 1.5em; }
  }
  #recipe-content h3 {
    color: #666;
    font-size: 1.1em;
  }
  @media (min-width: 768px) {
    #recipe-content h3 { font-size: 1.2em; }
  }
  #recipe-content code {
    background: #f5f5f5;
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-family: 'Courier New', monospace;
  }
  #recipe-content pre {
    background: #f5f5f5;
    padding: 1em;
    border-radius: 4px;
    overflow-x: auto;
  }
  #recipe-content pre code {
    background: none;
    padding: 0;
  }
  #recipe-content ul, #recipe-content ol {
    padding-left: 2em;
  }
  #recipe-content li {
    margin: 0.5em 0;
  }
  #recipe-content blockquote {
    border-left: 4px solid #007BFF;
    padding-left: 1em;
    margin-left: 0;
    color: #666;
  }
  #recipe-content img {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
  }
    .loading-message {
    text-align: center;
    padding: 2em;
    color: #666;
  }
  
  /* Recipe Ideas Section */
  #ideas-section {
    max-width: 900px;
    margin: 0 auto;
    background: white;
    padding: 1em;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  @media (min-width: 768px) {
    #ideas-section { padding: 2em; }
  }
  #ideas-section.hidden {
    display: none;
  }
  .ideas-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1em;
    flex-wrap: wrap;
    gap: 1em;
  }
  .ideas-header h1 {
    margin: 0;
    font-size: 1.6em;
    color: #333;
    border-bottom: 3px solid #007BFF;
    padding-bottom: 0.3em;
    flex: 1;
  }
  @media (min-width: 768px) {
    .ideas-header h1 { font-size: 2em; }
  }
  .ideas-textarea {
    width: 100%;
    min-height: 300px;
    padding: 1em;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 1em;
    line-height: 1.6;
    resize: vertical;
    -webkit-tap-highlight-color: transparent;
  }
  .ideas-textarea:focus {
    outline: none;
    border-color: #007BFF;
  }
  .ideas-textarea::placeholder {
    color: #999;
  }
  .ideas-actions {
    display: flex;
    gap: 0.5em;
    margin-top: 1em;
    flex-wrap: wrap;
  }
  .btn {
    padding: 0.7em 1.2em;
    border: none;
    border-radius: 4px;
    font-size: 1em;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5em;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    min-height: 44px;
  }
  @media (min-width: 768px) {
    .btn {
      padding: 0.5em 1em;
      min-height: auto;
    }
  }
  .btn-primary {
    background: #007BFF;
    color: white;
  }
  .btn-primary:hover, .btn-primary:active {
    background: #0056b3;
  }
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  .btn-secondary:hover, .btn-secondary:active {
    background: #545b62;
  }
  .btn-success {
    background: #28a745;
    color: white;
  }
  .copy-feedback {
    display: inline-block;
    color: #28a745;
    font-size: 0.9em;
    margin-left: 0.5em;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .copy-feedback.show {
    opacity: 1;
  }
  .ideas-info {
    background: #f8f9fa;
    padding: 1em;
    border-radius: 4px;
    margin-bottom: 1em;
    font-size: 0.9em;
    color: #666;
    line-height: 1.5;
  }
  .ideas-tab-btn {
    background: #f8f9fa;
    color: #007BFF;
    border: 2px solid #007BFF;
    padding: 0.5em 1em;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    min-height: 44px;
    display: inline-flex;
    align-items: center;
    gap: 0.3em;
  }
  .ideas-tab-btn:hover, .ideas-tab-btn:active {
    background: #007BFF;
    color: white;
  }
</style>
</head>
<body>
<div class="header">
  <h1>üç≥ Recipes Collection</h1>
  <div class="subtitle">
    Browse recipes organized by language and category
    <button class="ideas-tab-btn" onclick="showIdeas()" style="margin-left: 1em;">üí° Recipe Ideas</button>
  </div>
</div>
<div id="recipe-list">
  <div id="content"></div>
  <div class="timestamp">Last updated: 11/7/2025, 8:52:11 AM</div>
</div>
<div id="recipe-viewer" class="hidden">
  <button class="back-button" onclick="showRecipeList()">‚Üê Back to Recipes</button>
  <button class="refactor-button" onclick="refactorRecipe()">ü§ñ Refactor with AI</button>
  <span class="refactor-feedback" id="refactor-feedback">‚úì Copied to clipboard! Paste into Claude.</span>
  <div id="recipe-content"></div>
</div>
<div id="ideas-section" class="hidden">
  <div class="ideas-header">
    <h1>üí° Recipe Ideas</h1>
    <button class="ideas-tab-btn" onclick="showRecipeList()">‚Üê Back to Recipes</button>
  </div>
  <div class="ideas-info">
    üí≠ Use this space to brainstorm recipe ideas on your phone. Auto-saves as you type. Click "Copy All" to paste into Claude or your AI tool later!
  </div>
  <textarea 
    id="ideas-textarea" 
    class="ideas-textarea" 
    placeholder="Jot down your recipe ideas here...

Example:
- Try making Turkish eggs with sriracha instead of Aleppo pepper
- Experiment with sweet potato gnocchi
- Air fryer version of grandma's empanadas

Your ideas are automatically saved to this device."
  ></textarea>
  <div class="ideas-actions">
    <button class="btn btn-primary" onclick="copyIdeas()">üìã Copy All</button>
    <button class="btn btn-secondary" onclick="clearIdeas()">üóëÔ∏è Clear</button>
    <span class="copy-feedback" id="copy-feedback">‚úì Copied!</span>
  </div>
</div>

<script>
const RECIPES_DATA = {
  "generated": "2025-11-07T11:52:11.622Z",
  "structure": [
    {
      "name": "english",
      "type": "folder",
      "path": "english",
      "children": [
        {
          "name": "bakery",
          "type": "folder",
          "path": "english/bakery",
          "children": [
            {
              "name": "banana_bread",
              "type": "file",
              "path": "english/bakery/banana_bread.md"
            }
          ]
        },
        {
          "name": "methods",
          "type": "folder",
          "path": "english/methods",
          "children": [
            {
              "name": "air_fryer_sweet_potato_cubes",
              "type": "file",
              "path": "english/methods/air_fryer_sweet_potato_cubes.md"
            },
            {
              "name": "air_fryer_sweet_potato_fries",
              "type": "file",
              "path": "english/methods/air_fryer_sweet_potato_fries.md"
            },
            {
              "name": "air_fryer_sweet_potato_wedges",
              "type": "file",
              "path": "english/methods/air_fryer_sweet_potato_wedges.md"
            },
            {
              "name": "air_fryer_whole_baked_sweet_potato",
              "type": "file",
              "path": "english/methods/air_fryer_whole_baked_sweet_potato.md"
            },
            {
              "name": "chicago_deep_dish_pizza_sauce",
              "type": "file",
              "path": "english/methods/chicago_deep_dish_pizza_sauce.md"
            },
            {
              "name": "detroit_style_pizza_sauce",
              "type": "file",
              "path": "english/methods/detroit_style_pizza_sauce.md"
            },
            {
              "name": "neapolitan_pizza_sauce",
              "type": "file",
              "path": "english/methods/neapolitan_pizza_sauce.md"
            },
            {
              "name": "new_york_pizza_sauce",
              "type": "file",
              "path": "english/methods/new_york_pizza_sauce.md"
            },
            {
              "name": "pizza_sauce_techniques",
              "type": "file",
              "path": "english/methods/pizza_sauce_techniques.md"
            },
            {
              "name": "poached_eggs_tips",
              "type": "file",
              "path": "english/methods/poached_eggs_tips.md"
            },
            {
              "name": "roasted_tomato_sauce",
              "type": "file",
              "path": "english/methods/roasted_tomato_sauce.md"
            },
            {
              "name": "tzatziki_sauce_techniques",
              "type": "file",
              "path": "english/methods/tzatziki_sauce_techniques.md"
            }
          ]
        },
        {
          "name": "recipes",
          "type": "folder",
          "path": "english/recipes",
          "children": [
            {
              "name": "burrata_caprese",
              "type": "file",
              "path": "english/recipes/burrata_caprese.md"
            },
            {
              "name": "burrata_roasted_tomatoes",
              "type": "file",
              "path": "english/recipes/burrata_roasted_tomatoes.md"
            },
            {
              "name": "burrata_tomato_confit",
              "type": "file",
              "path": "english/recipes/burrata_tomato_confit.md"
            },
            {
              "name": "cilbir_recipe",
              "type": "file",
              "path": "english/recipes/cilbir_recipe.md"
            },
            {
              "name": "el_tesoro_de_patitas",
              "type": "file",
              "path": "english/recipes/el_tesoro_de_patitas.md"
            },
            {
              "name": "greek_chicken_gyro_bowls",
              "type": "file",
              "path": "english/recipes/greek_chicken_gyro_bowls.md"
            },
            {
              "name": "tuna_tataki",
              "type": "file",
              "path": "english/recipes/tuna_tataki.md"
            },
            {
              "name": "zucchini_ground_meat_stew",
              "type": "file",
              "path": "english/recipes/zucchini_ground_meat_stew.md"
            }
          ]
        },
        {
          "name": "sauces",
          "type": "folder",
          "path": "english/sauces",
          "children": [
            {
              "name": "maestranza_inspired_sauce",
              "type": "file",
              "path": "english/sauces/maestranza_inspired_sauce.md"
            },
            {
              "name": "tzatziki_sauce",
              "type": "file",
              "path": "english/sauces/tzatziki_sauce.md"
            }
          ]
        },
        {
          "name": "spices",
          "type": "folder",
          "path": "english/spices",
          "children": [
            {
              "name": "zaatar_chilean_version",
              "type": "file",
              "path": "english/spices/zaatar_chilean_version.md"
            }
          ]
        }
      ]
    },
    {
      "name": "spanish",
      "type": "folder",
      "path": "spanish",
      "children": [
        {
          "name": "bakery",
          "type": "folder",
          "path": "spanish/bakery",
          "children": [
            {
              "name": "pan_de_platano",
              "type": "file",
              "path": "spanish/bakery/pan_de_platano.md"
            }
          ]
        },
        {
          "name": "methods",
          "type": "folder",
          "path": "spanish/methods",
          "children": [
            {
              "name": "consejos_huevos_escalfados",
              "type": "file",
              "path": "spanish/methods/consejos_huevos_escalfados.md"
            },
            {
              "name": "gajos_de_papa_dulce_en_freidora_de_aire",
              "type": "file",
              "path": "spanish/methods/gajos_de_papa_dulce_en_freidora_de_aire.md"
            },
            {
              "name": "papa_dulce_entera_al_horno_en_freidora_de_aire",
              "type": "file",
              "path": "spanish/methods/papa_dulce_entera_al_horno_en_freidora_de_aire.md"
            },
            {
              "name": "papas_dulces_en_cubos_en_freidora_de_aire",
              "type": "file",
              "path": "spanish/methods/papas_dulces_en_cubos_en_freidora_de_aire.md"
            },
            {
              "name": "papas_dulces_fritas_en_freidora_de_aire",
              "type": "file",
              "path": "spanish/methods/papas_dulces_fritas_en_freidora_de_aire.md"
            },
            {
              "name": "salsa_de_tomates_asados",
              "type": "file",
              "path": "spanish/methods/salsa_de_tomates_asados.md"
            },
            {
              "name": "salsa_pizza_chicago",
              "type": "file",
              "path": "spanish/methods/salsa_pizza_chicago.md"
            },
            {
              "name": "salsa_pizza_detroit",
              "type": "file",
              "path": "spanish/methods/salsa_pizza_detroit.md"
            },
            {
              "name": "salsa_pizza_napolitana",
              "type": "file",
              "path": "spanish/methods/salsa_pizza_napolitana.md"
            },
            {
              "name": "salsa_pizza_nueva_york",
              "type": "file",
              "path": "spanish/methods/salsa_pizza_nueva_york.md"
            },
            {
              "name": "tecnicas_salsa_pizza",
              "type": "file",
              "path": "spanish/methods/tecnicas_salsa_pizza.md"
            },
            {
              "name": "tecnicas_salsa_tzatziki",
              "type": "file",
              "path": "spanish/methods/tecnicas_salsa_tzatziki.md"
            }
          ]
        },
        {
          "name": "recipes",
          "type": "folder",
          "path": "spanish/recipes",
          "children": [
            {
              "name": "boles_de_gyro_de_pollo_griego",
              "type": "file",
              "path": "spanish/recipes/boles_de_gyro_de_pollo_griego.md"
            },
            {
              "name": "burrata_caprese",
              "type": "file",
              "path": "spanish/recipes/burrata_caprese.md"
            },
            {
              "name": "burrata_confit_tomate",
              "type": "file",
              "path": "spanish/recipes/burrata_confit_tomate.md"
            },
            {
              "name": "burrata_tomates_asados",
              "type": "file",
              "path": "spanish/recipes/burrata_tomates_asados.md"
            },
            {
              "name": "el_tesoro_de_patitas",
              "type": "file",
              "path": "spanish/recipes/el_tesoro_de_patitas.md"
            },
            {
              "name": "guiso_de_zapallo_italiano_y_carne_molida",
              "type": "file",
              "path": "spanish/recipes/guiso_de_zapallo_italiano_y_carne_molida.md"
            },
            {
              "name": "receta_cilbir",
              "type": "file",
              "path": "spanish/recipes/receta_cilbir.md"
            },
            {
              "name": "tataki_de_atun",
              "type": "file",
              "path": "spanish/recipes/tataki_de_atun.md"
            }
          ]
        },
        {
          "name": "sauces",
          "type": "folder",
          "path": "spanish/sauces",
          "children": [
            {
              "name": "salsa_inspirada_en_la_maestranza",
              "type": "file",
              "path": "spanish/sauces/salsa_inspirada_en_la_maestranza.md"
            },
            {
              "name": "salsa_tzatziki",
              "type": "file",
              "path": "spanish/sauces/salsa_tzatziki.md"
            }
          ]
        },
        {
          "name": "spices",
          "type": "folder",
          "path": "spanish/spices",
          "children": [
            {
              "name": "zaatar_chileno",
              "type": "file",
              "path": "spanish/spices/zaatar_chileno.md"
            }
          ]
        }
      ]
    },
    {
      "name": "DEPLOYMENT",
      "type": "file",
      "path": "DEPLOYMENT.md"
    },
    {
      "name": "README",
      "type": "file",
      "path": "README.md"
    }
  ]
};

let expandedFolders = new Set();

function createFolderElement(item, level = 0) {
  const folder = document.createElement('div');
  folder.className = 'folder';
  
  const folderName = document.createElement('div');
  folderName.className = 'folder-name';
  const isExpanded = expandedFolders.has(item.path);
  folderName.innerHTML = `<span class="folder-icon">${isExpanded ? 'üìÇ' : 'üìÅ'}</span>${formatName(item.name)}`;
  
  const contents = document.createElement('div');
  contents.className = `folder-contents ${isExpanded ? '' : 'collapsed'}`;
  
  folderName.onclick = () => {
    const icon = folderName.querySelector('.folder-icon');
    if (contents.classList.contains('collapsed')) {
      contents.classList.remove('collapsed');
      icon.textContent = 'üìÇ';
      expandedFolders.add(item.path);
    } else {
      contents.classList.add('collapsed');
      icon.textContent = 'üìÅ';
      expandedFolders.delete(item.path);
    }
  };
  
  if (item.children) {
    item.children.forEach(child => {
      if (child.type === 'folder') {
        contents.appendChild(createFolderElement(child, level + 1));
      } else {
        contents.appendChild(createFileElement(child));
      }
    });
  }
  
  folder.appendChild(folderName);
  folder.appendChild(contents);
  return folder;
}

function createFileElement(item) {
  const file = document.createElement('div');
  file.className = 'file';
  
  const link = document.createElement('a');
  link.href = '#';
  link.textContent = formatName(item.name);
  link.onclick = (e) => {
    e.preventDefault();
    loadRecipe(item.path, formatName(item.name));
  };
  
  file.appendChild(link);
  return file;
}

function formatName(name) {
  return name
    .replace(/_/g, ' ')
    .replace(/\b\w/g, l => l.toUpperCase());
}

function renderStructure(structure) {
  const container = document.createElement('div');
  container.className = 'container';
  
  structure.forEach(item => {
    if (item.type === 'folder' && (item.name === 'english' || item.name === 'spanish')) {
      const section = document.createElement('div');
      section.className = 'language-section';
      
      const title = document.createElement('h2');
      title.textContent = item.name === 'english' ? 'üá¨üáß English' : 'üá™üá∏ Spanish';
      section.appendChild(title);
      
      if (item.children) {
        item.children.forEach(child => {
          if (child.type === 'folder') {
            section.appendChild(createFolderElement(child));
          }
        });
      }
      
      container.appendChild(section);
    }
  });
  
  return container;
}

function loadRecipes() {
  const content = document.getElementById('content');
  content.appendChild(renderStructure(RECIPES_DATA.structure));
}

let currentServings = 1;
let originalServings = 1;
let originalIngredients = [];
let currentRecipeMarkdown = '';
let currentRecipePath = '';
let currentRecipeTitle = '';

async function loadRecipe(path, title) {
  const recipeViewer = document.getElementById('recipe-viewer');
  const recipeContent = document.getElementById('recipe-content');
  const recipeList = document.getElementById('recipe-list');
  
  // Store current recipe info for refactoring
  currentRecipePath = path;
  currentRecipeTitle = title;
  
  // Show loading message
  recipeContent.innerHTML = '<div class="loading-message">Loading recipe...</div>';
  recipeList.classList.add('hidden');
  recipeViewer.classList.remove('hidden');
  
  // Scroll to top
  window.scrollTo(0, 0);
  
  try {
    const response = await fetch(path);
    if (!response.ok) throw new Error('Failed to load recipe');
    
    const markdown = await response.text();
    currentRecipeMarkdown = markdown; // Store for refactoring
    const html = marked.parse(markdown);
    recipeContent.innerHTML = html;
    
    // Initialize serving size adjuster
    initializeServingAdjuster(markdown);
  } catch (error) {
    recipeContent.innerHTML = `
      <div style="color: #c33; padding: 1em; background: #fee; border-radius: 4px;">
        ‚ö†Ô∏è Failed to load recipe. Please try again.
      </div>
    `;
  }
}

function parseServingSize(markdown) {
  // Try to find serving size in various formats
  const patterns = [
    /(?:Yields?|Servings?|Serves?):s*(d+)s*servings?/i,
    /(?:Yields?|Servings?|Serves?):s*(d+)/i,
    /(d+)s*servings?/i
  ];
  
  for (const pattern of patterns) {
    const match = markdown.match(pattern);
    if (match) {
      return parseInt(match[1]);
    }
  }
  return 1; // Default to 1 if not found
}

function parseQuantity(text) {
  // Parse fractions, decimals, ranges, and whole numbers
  const fractionMap = {
    '¬º': 0.25, '¬Ω': 0.5, '¬æ': 0.75,
    '‚Öì': 0.333, '‚Öî': 0.667,
    '‚Öõ': 0.125, '‚Öú': 0.375, '‚Öù': 0.625, '‚Öû': 0.875,
    '‚Öï': 0.2, '‚Öñ': 0.4, '‚Öó': 0.6, '‚Öò': 0.8,
    '1/4': 0.25, '1/2': 0.5, '3/4': 0.75,
    '1/3': 0.333, '2/3': 0.667,
    '1/8': 0.125, '3/8': 0.375, '5/8': 0.625, '7/8': 0.875
  };
  
  // Match patterns like "2 1/2", "2.5", "2-3", etc.
  const patterns = [
    /^(\d+)\s+([¬º¬Ω¬æ‚Öì‚Öî‚Öõ‚Öú‚Öù‚Öû‚Öï‚Öñ‚Öó‚Öò]|\d+\/\d+)/, // e.g., "2 1/2"
    /^([¬º¬Ω¬æ‚Öì‚Öî‚Öõ‚Öú‚Öù‚Öû‚Öï‚Öñ‚Öó‚Öò]|\d+\/\d+)/, // e.g., "1/2"
    /^(\d+\.\d+)/, // e.g., "2.5"
    /^(\d+)-(\d+)/, // e.g., "2-3" (range)
    /^(\d+)/ // e.g., "2"
  ];
  
  for (const pattern of patterns) {
    const match = text.match(pattern);
    if (match) {
      if (match[2]) {
        // Whole number + fraction (e.g., "2 1/2")
        const whole = parseInt(match[1]);
        const fraction = fractionMap[match[2]] || eval(match[2]);
        return whole + fraction;
      } else if (match[1].includes('-')) {
        // Range (e.g., "2-3") - use average
        const [min, max] = match[0].split('-').map(Number);
        return (min + max) / 2;
      } else if (fractionMap[match[1]]) {
        // Just a fraction
        return fractionMap[match[1]];
      } else if (match[1].includes('/')) {
        // Fraction like "1/4"
        return eval(match[1]);
      } else {
        // Regular number
        return parseFloat(match[1]);
      }
    }
  }
  return null;
}

function formatQuantity(num) {
  if (num === null) return '';
  
  // Round to 2 decimal places
  num = Math.round(num * 100) / 100;
  
  // Convert to fraction if close to common fractions
  const fractions = [
    [0.125, '‚Öõ'], [0.25, '¬º'], [0.333, '‚Öì'], [0.375, '‚Öú'],
    [0.5, '¬Ω'], [0.625, '‚Öù'], [0.667, '‚Öî'], [0.75, '¬æ'], [0.875, '‚Öû']
  ];
  
  const whole = Math.floor(num);
  const decimal = num - whole;
  
  for (const [val, frac] of fractions) {
    if (Math.abs(decimal - val) < 0.05) {
      return whole > 0 ? `${whole} ${frac}` : frac;
    }
  }
  
  return num % 1 === 0 ? num.toString() : num.toFixed(1);
}

function scaleIngredients(scale) {
  const content = document.getElementById('recipe-content');
  const items = content.querySelectorAll('li');
  
  items.forEach((item, index) => {
    const original = originalIngredients[index];
    if (!original) return;
    
    const quantity = parseQuantity(original);
    if (quantity !== null) {
      const scaled = quantity * scale;
      const formatted = formatQuantity(scaled);
      
      // Replace the quantity in the text
      const quantityRegex = /^[\d\.\s¬º¬Ω¬æ‚Öì‚Öî‚Öõ‚Öú‚Öù‚Öû‚Öï‚Öñ‚Öó‚Öò\/\-]+/;
      item.textContent = item.textContent.replace(quantityRegex, formatted + ' ');
    }
  });
}

function initializeServingAdjuster(markdown) {
  const content = document.getElementById('recipe-content');
  
  // Parse original serving size
  originalServings = parseServingSize(markdown);
  currentServings = originalServings;
  
  // Store original ingredient text
  originalIngredients = [];
  const items = content.querySelectorAll('li');
  items.forEach(item => {
    originalIngredients.push(item.textContent);
  });
  
  // Create serving adjuster UI
  const adjuster = document.createElement('div');
  adjuster.className = 'serving-adjuster';
  adjuster.innerHTML = `
    <div class="serving-label">Adjust Servings:</div>
    <div class="serving-controls">
      <button class="serving-btn" id="decrease-serving" aria-label="Decrease servings">‚àí</button>
      <div class="serving-value" id="serving-display">${currentServings} serving${currentServings !== 1 ? 's' : ''}</div>
      <button class="serving-btn" id="increase-serving" aria-label="Increase servings">+</button>
    </div>
  `;
  
  // Insert after the first heading or at the start
  const firstHeading = content.querySelector('h2, h3');
  if (firstHeading) {
    firstHeading.parentNode.insertBefore(adjuster, firstHeading);
  } else {
    content.insertBefore(adjuster, content.firstChild);
  }
  
  // Add event listeners
  document.getElementById('decrease-serving').addEventListener('click', () => {
    if (currentServings > 1) {
      currentServings -= 1;
      updateServings();
    }
  });
  
  document.getElementById('increase-serving').addEventListener('click', () => {
    if (currentServings < 99) {
      currentServings += 1;
      updateServings();
    }
  });
}

function updateServings() {
  const scale = currentServings / originalServings;
  const display = document.getElementById('serving-display');
  const decreaseBtn = document.getElementById('decrease-serving');
  
  display.textContent = `${currentServings} serving${currentServings !== 1 ? 's' : ''}`;
  decreaseBtn.disabled = currentServings <= 1;
  
  scaleIngredients(scale);
}

function showRecipeList() {
  const recipeViewer = document.getElementById('recipe-viewer');
  const recipeList = document.getElementById('recipe-list');
  const ideasSection = document.getElementById('ideas-section');
  
  recipeViewer.classList.add('hidden');
  ideasSection.classList.add('hidden');
  recipeList.classList.remove('hidden');
  window.scrollTo(0, 0);
}

// Recipe Ideas Functions
const IDEAS_STORAGE_KEY = 'recipe-ideas';

function loadIdeas() {
  const textarea = document.getElementById('ideas-textarea');
  const saved = localStorage.getItem(IDEAS_STORAGE_KEY);
  if (saved) {
    textarea.value = saved;
  }
}

function saveIdeas() {
  const textarea = document.getElementById('ideas-textarea');
  localStorage.setItem(IDEAS_STORAGE_KEY, textarea.value);
}

function showIdeas() {
  const recipeViewer = document.getElementById('recipe-viewer');
  const recipeList = document.getElementById('recipe-list');
  const ideasSection = document.getElementById('ideas-section');
  
  recipeViewer.classList.add('hidden');
  recipeList.classList.add('hidden');
  ideasSection.classList.remove('hidden');
  
  loadIdeas();
  window.scrollTo(0, 0);
}

async function copyIdeas() {
  const textarea = document.getElementById('ideas-textarea');
  const feedback = document.getElementById('copy-feedback');
  
  try {
    await navigator.clipboard.writeText(textarea.value);
    feedback.classList.add('show');
    setTimeout(() => {
      feedback.classList.remove('show');
    }, 2000);
  } catch (err) {
    // Fallback for older browsers
    textarea.select();
    document.execCommand('copy');
    feedback.classList.add('show');
    setTimeout(() => {
      feedback.classList.remove('show');
    }, 2000);
  }
}

function clearIdeas() {
  if (confirm('Are you sure you want to clear all your recipe ideas? This cannot be undone.')) {
    const textarea = document.getElementById('ideas-textarea');
    textarea.value = '';
    localStorage.removeItem(IDEAS_STORAGE_KEY);
  }
}

// Recipe Refactoring with AI
async function refactorRecipe() {
  const feedback = document.getElementById('refactor-feedback');
  
  if (!currentRecipeMarkdown) {
    alert('No recipe loaded. Please open a recipe first.');
    return;
  }
  
  const prompt = `I need you to refactor and improve this recipe. Please:

1. **Maintain the exact markdown format** (headings, lists, bold text, etc.)
2. **Improve clarity** - Make instructions clearer and more precise
3. **Enhance techniques** - Add helpful cooking tips where appropriate
4. **Optimize measurements** - Ensure quantities are practical and accurate
5. **Fix any issues** - Correct typos, unclear language, or logical flow problems
6. **Keep the same structure** - Don't change the overall organization
7. **Preserve the essence** - This is my personal recipe, keep its character

Current recipe markdown:

---
${currentRecipeMarkdown}
---

Please provide the improved recipe in markdown format, ready to copy directly into my recipe file (${currentRecipePath}).

After you provide the refactored recipe, I'll review it and update my local markdown file manually.
`;

  try {
    await navigator.clipboard.writeText(prompt);
    feedback.classList.add('show');
    setTimeout(() => {
      feedback.classList.remove('show');
    }, 4000);
  } catch (err) {
    // Fallback for older browsers
    const textarea = document.createElement('textarea');
    textarea.value = prompt;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    
    feedback.classList.add('show');
    setTimeout(() => {
      feedback.classList.remove('show');
    }, 4000);
  }
}

// Auto-save on typing
document.addEventListener('DOMContentLoaded', () => {
  const textarea = document.getElementById('ideas-textarea');
  if (textarea) {
    textarea.addEventListener('input', saveIdeas);
  }
});

loadRecipes();

// Register service worker for PWA
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker registered'))
      .catch(err => console.log('Service Worker registration failed:', err));
  });
}
</script>
</body>
</html>
